# table with stop info and geometry
create temporary sequence id;
create table stop_animation as select nextval('id') as id, a.agency_id, a.arrival_time, 
substring(arrival_time from E'^([^:]+):')::int * 60 * 60 + substring(arrival_time from E'^[^:]+:([^:]+):')::int * 60 + substring(arrival_time from E':([^:]+)$')::int as seconds_from_midnight,
substring(arrival_time from E'^([^:]+):')::int * 60 + substring(arrival_time from E'^[^:]+:([^:]+):')::int as minutes_from_midnight,
c.route_short_name, d.description, e.stop_name, e.stop_lat, e.stop_lon, 
a.agency_id||d.description as color_code,
e.the_geom from stop_times a join trips b using (agency_id,trip_id) join routes c using (agency_id,route_id) join route_types d using (route_type) join stops e using (agency_id,stop_id);

create index time_idx on stop_animation using btree(arrival_time);
create index min_idx on stop_animation using btree(minutes_from_midnight);
create index sec_idx on stop_animation using btree(seconds_from_midnight);
alter table stop_animation add primary key (id);


PYTHON FIXES
sudo python_select python26

for i in {0..1821}; do
	echo "drop table tmp; create table tmp as select * from stop_animation where minutes_from_midnight = $i;" | psql -U gtfs -d geo
	pgsql2shp -f anim_$i -u gtfs geo gtfs.tmp
done

http://underdark.wordpress.com/2010/11/30/creating-high-resolution-images-using-qgis/

[open /Applications/qgis.app --args ...]

extents: 	